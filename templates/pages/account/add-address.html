{{#partial "page"}}

    {{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}

    {{#if forms.address.address_id}}
        <h2 class="page-heading">{{lang 'forms.address.edit.heading'}}</h2>
    {{else}}
        <h2 class="page-heading">{{lang 'forms.address.add.heading'}}</h2>
    {{/if}}

    {{> components/account/navigation account_page='addresses'}}

    <div class="account account--fixed">

        {{#if forms.address.error}}
            {{> components/common/alert/alert-error forms.address.error}}
        {{/if}}

        <div class="account-body">
            <section class="account-content">
                <div id="address-map-container" style="margin-bottom: 20px;">
                    <label class="form-label" for="address-map-canvas">{{!-- TODO: Add a lang string for this label --}}Drag the pin to set your address or fill the fields below:</label>
                    <div id="address-map-canvas" style="height: 350px; width: 100%; border: 1px solid #ccc; position: relative;">
                        {{!-- Loader and messages will be injected here by JS --}}
                    </div>
                </div>

                <form action="{{forms.address.action}}" data-address-form class="form" method="post">
                    {{#if forms.address.address_id }}
                        <input type="hidden" name="shipid" value="{{forms.address.address_id}}">
                    {{/if}}
                    <fieldset class="form-fieldset">
                        <div class="form-row form-row--half">
                            {{#each forms.address.shipping_fields }}
                                {{!-- Ensure inputs have IDs for map interaction --}}
                                {{#if field_type '===' 'text'}}
                                    {{#if name '===' 'shipping-address-street'}}
                                        <input type="hidden" name="shipping-address-street-lat" data-map-latitude>
                                        <input type="hidden" name="shipping-address-street-lng" data-map-longitude>
                                    {{/if}}
                                    <div class="form-field" id="FormField_{{id}}" {{#if private_id}}data-type="{{private_id}}"{{/if}}>
                                        <label class="form-label" for="_{{id}}">{{label}}
                                            {{#if required}}<small>{{lang 'common.required'}}</small>{{/if}}
                                        </label>
                                        <input class="form-input" type="{{type}}" id="_{{id}}" name="{{name}}" value="{{value}}" {{#if name '===' 'shipping-address-street'}}data-map-street1{{/if}} {{#if name '===' 'shipping-address-city'}}data-map-city{{/if}} {{#if name '===' 'shipping-address-zip'}}data-map-zip{{/if}}>
                                    </div>
                                {{else if field_type '===' 'dropdown'}}
                                     <div class="form-field" id="FormField_{{id}}" {{#if private_id}}data-type="{{private_id}}"{{/if}}>
                                        <label class="form-label" for="_{{id}}">{{label}}
                                            {{#if required}}<small>{{lang 'common.required'}}</small>{{/if}}
                                        </label>
                                        <select class="form-select" id="_{{id}}" name="{{name}}" {{#if name '===' 'shipping-address-state'}}data-map-state{{/if}} {{#if name '===' 'shipping-address-country'}}data-map-country data-field-type="Country"{{else if name '===' 'shipping-address-state'}}data-field-type="State"{{/if}}>
                                            {{#each options}}
                                                <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                {{else}}
                                     {{{dynamicComponent 'components/common/forms'}}}
                                {{/if}}
                            {{/each}}
                        </div>
                    </fieldset>
                    <div class="form-actions">
                        <input type="submit" class="button button--primary" value="{{lang 'forms.address.submit_value'}}">
                        <a href="{{urls.account.addresses}}" class="button">{{lang 'common.cancel'}}</a>
                        {{inject 'required' (lang 'common.required')}}
                        {{inject 'state_error' (lang 'errors.state_error')}}
                    </div>
                </form>
            </section>
        </div>
    </div>

{{/partial}}
{{> layout/base}}
